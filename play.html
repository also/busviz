<html>
<head>
<title>a day on the bus</title>
<script type="text/javascript" src="geo.js"></script>
<script type="text/javascript" src="viz.js"></script>
<script type="text/javascript" src="jquery-1.4.2.min.js"></script>
<script type="text/javascript">
function load() {
  var interval;
  $.ajax({
    type: 'GET',
    url: '15th.csv',
    success: function (data) {
      drawProgress(1);
      clearInterval(interval);
      setTimeout(function () {
        var lines = data.split('\n');
        draw(lines);
      }, 1000);
    },
    beforeSend: function (xhr) {
      interval = setInterval(function () {
        if (xhr.readyState > 2) {
          var totalBytes = xhr.getResponseHeader('Content-length');
          var dlBytes = xhr.responseText.length;
          drawProgress(dlBytes / totalBytes);
        }
      }, 200);
    }
  });
}

function drawProgress(progress) {
  var canvas = $('#canvas').get(0);
  var ctx = canvas.getContext('2d');
  ctx.clearRect(0, 0, canvas.width, canvas.height);
  ctx.save();
  ctx.translate(canvas.width - 50, 50);
  ctx.rotate(3 * Math.PI / 2);
  ctx.strokeStyle = '#aaa';
  ctx.lineWidth = 2;
  ctx.beginPath();
  if (progress != 1) {
    ctx.moveTo(0, 0);
  }
  ctx.arc(0, 0, 25, 0, Math.PI * 2 * progress, false);
  if (progress != 1) {
    ctx.lineTo(0, 0);
  }
  ctx.stroke();
  ctx.restore();
}

load();
</script>
<style type="text/css">
body {
    background: #000;
    padding: 0;
    margin: 0;
}
#wrapper {
    margin: 30px auto;
    width: 1280px;
    border: 1px solid #111;
}
</style>
</head>
<body>
<div id="wrapper">
<canvas id="canvas" width="1280" height="720"></canvas>
</div>
</body>
</html>
